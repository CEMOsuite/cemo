# Tasmanian region
load 'cemo_db/cemo.db' using=sqlite3 format=set
query = "SELECT id as R FROM region WHERE text_id in ('VIC','TAS');" : R;

# Tasmanian planning zones
#set Z:= 16;
load 'cemo_db/cemo.db' using=sqlite3 format=set
query="SELECT id as Z
FROM ntndp_zone
WHERE region_id in
(SELECT id FROM region WHERE text_id in ('VIC','TAS'));": Z;

# Tasmanian planning zones
#set Z:= 16;
load 'cemo_db/cemo.db' using=sqlite3 format=set
query="SELECT region_id as R, id as Z
FROM ntndp_zone
WHERE region_id in
(SELECT id FROM region WHERE text_id in ('VIC','TAS'));": ZinR;

#Set of all unique technology identifiers
load 'cemo_db/cemo.db' using=sqlite3 format=set
query="select distinct technology_type_id as N from CAPEX;" :N;

#Ordered set of timestams to retrieve traces for dispatch calculations
load 'cemo_db/cemo.db' using=sqlite3 format=set
query="SELECT DISTINCT timestamp
FROM demand_and_rooftop_traces
WHERE  timestamp BETWEEN '2020-01-01 00:00:01' AND '2020-01-02 00:00:00'
AND timestamp NOT LIKE '%:30:%';" :T;

load 'cemo_db/cemo.db' using=sqlite3 format=set
query="SELECT ntndp_zone_id, technology_type_id
FROM capex
WHERE year = 2020
AND ntndp_zone_id in (SELECT id from ntndp_zone where region_id in (SELECT id FROM region WHERE text_id in ('VIC','TAS')))
AND source_scenario_id = 1
ORDER by ntndp_zone_id;": TechinZones;

# set D:= Winter Summer Peak;

set Inv:= 2020;

param Cuns:= 200;

param Csur:=-5.0;
#Load Technology costs
#Note SQL query instructions are case sensitive
load 'cemo_db/cemo.db' using=sqlite3
query="SELECT capex.ntndp_zone_id as Z,capex.technology_type_id as N,
capex.year as Inv,capex.capex as CC, opex.fom as CF, opex.vom as CV
FROM capex
INNER JOIN opex ON capex.technology_type_id = opex.technology_type_id
WHERE capex.year=2020 AND capex.source_scenario_id =1
AND ntndp_zone_id in (SELECT id from ntndp_zone where region_id in (SELECT id FROM region WHERE text_id in ('VIC','TAS')))
AND opex.source_id = 1;": [Z,N,Inv] CC CF CV;

#load operating and maximum capacity for all technolgies and regions
load 'data/MCOC_TASVIC.csv' : [Z,N] OpCap0 MaxCap;

#Load capacity factors for all technologies
#load 'data/CapFactor.csv' : [Z, N ,T] capf;
load 'cemo_db/cemo.db' using=sqlite3
query="SELECT ntndp_zone_id as Z,technology_type_id as N,timestamp as T,mw as capf,  wind_bubble_id
FROM wind_and_solar_traces data
INNER JOIN (SELECT   ntndp_zone_id as a,technology_type_id as b
	FROM capex
	WHERE year = 2020
	AND ntndp_zone_id in (SELECT id from ntndp_zone where region_id in (SELECT id FROM region WHERE text_id in ('VIC','TAS')))
	AND source_scenario_id = 1
	order by ntndp_zone_id) as pair
	ON  pair.a = data.ntndp_zone_id AND pair.b =data.technology_type_id
WHERE timestamp in (SELECT DISTINCT timestamp
FROM demand_and_rooftop_traces
WHERE  timestamp BETWEEN '2020-01-01 00:00:01' AND '2020-01-02 00:00:00'
AND timestamp NOT LIKE '%:30:%')
AND wind_bubble_id NOT IN (14,22,23,24)" : [Z,N,T] capf;

#load Load for all polygons
load 'cemo_db/cemo.db' using=sqlite3
query="SELECT zone.region_id as R,demand.timestamp as T,demand.poe10 as Ld
FROM demand_and_rooftop_traces demand
INNER JOIN ntndp_zone zone ON demand.region_id = zone.region_id
WHERE demand.timestamp in (SELECT DISTINCT timestamp
FROM demand_and_rooftop_traces
WHERE  timestamp BETWEEN '2020-01-01 00:00:01' AND '2020-01-02 00:00:00'
AND timestamp NOT LIKE '%:30:%')
AND demand.source_scenario_id =1
AND demand.region_id IN (4,5)": [R,T] Ld;
